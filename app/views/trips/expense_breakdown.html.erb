<h1><%= @trip.name %>: Expense Breakdown</h1>
<%= link_to "Back to Trip", trip_path(@trip), class: "btn btn-secondary" %>

<!-- Responsive Chart Container -->
<div style="width: 300px; margin-top: 2rem;">
  <canvas id="expenseChart"></canvas>
</div>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script type="text/javascript">
  document.addEventListener("turbo:load", function () {
    const ctx = document.getElementById("expenseChart").getContext("2d");

    if (window.expenseChartInstance) {
      window.expenseChartInstance.destroy();
    }

    const labels = <%= raw @category_totals.keys.to_json %>;
    const data = <%= raw @category_totals.values.map(&:to_f).to_json %>;

    window.expenseChartInstance = new Chart(ctx, {
      type: "pie",
      data: {
        labels: labels,
        datasets: [{
          label: "Expenses by Category",
          data: data,
          backgroundColor: [
            "#4e79a7", "#f28e2c", "#e15759",
            "#76b7b2", "#59a14f", "#edc948"
          ]
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: true
      }
    });
  });
</script>
