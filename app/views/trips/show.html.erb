<div class="container my-5">
  <!-- Trip Info -->
  <h1 class="text-center text-capitalize"><%= @trip.name %></h1>
  <p class="text-center text-muted">
    <strong>Start:</strong> <%= @trip.start_date %> |
    <strong>End:</strong> <%= @trip.end_date %>
  </p>

  <hr>

  <!-- Participants -->
  <div class="mb-4">
    <h3>Participants</h3>
    <ul>
      <% @trip.participants.each do |p| %>
        <li><%= p.name %> (<%= p.email %>)</li>
      <% end %>
    </ul>
  </div>

  <!-- Actions -->
  <div class="mb-4">
    <%= link_to 'Back to Trips', trips_path, class: 'btn btn-secondary me-2' %>
    <%= link_to "Add Expense", new_trip_expense_path(@trip), class: "btn btn-primary me-2" %>
    <%= link_to "Edit Trip", edit_trip_path(@trip), class: "btn btn-outline-secondary me-2" %>
    <%= link_to "View Expense Breakdown", expense_breakdown_trip_path(@trip), class: "btn btn-info" %>
  </div>

  <hr>

  <!-- Expenses -->
  <div class="mb-4">
    <h3>Expenses</h3>
    <% @trip.expenses.each do |expense| %>
      <div class="border p-3 mb-2 rounded">
        <p class="mb-1">
          <strong><%= expense.payer_name %></strong> paid
          $<%= expense.amount %> for
          <%= expense.description %> on
          <%= expense.date&.strftime("%b %d, %Y") %>
          (<%= pluralize(expense.participants.count, "person") %> shared)
        </p>
        <div>
          <%= link_to "Edit", edit_trip_expense_path(@trip, expense), class: "btn btn-sm btn-outline-warning me-2" %>
          <%= button_to "Delete", trip_expense_path(@trip, expense),
              method: :delete,
              data: { confirm: "Are you sure you want to delete this expense?" },
              class: "btn btn-sm btn-outline-danger" %>
        </div>
      </div>
    <% end %>
  </div>

  <hr>

  <!-- Participant Balances -->
  <div class="mb-4">
    <h3>Participant Balances</h3>
    <ul>
      <% @trip.participants.each do |p| %>
        <% total_paid = @trip.expenses.where(payer_name: p.name).sum(:amount) %>
        <% total_owed = @trip.expenses.joins(:participants).where(participants: { id: p.id }).sum("expenses.amount") / @trip.expenses.joins(:participants).where(participants: { id: p.id }).count.to_f rescue 0 %>
        <li><strong><%= p.name %></strong> paid $<%= total_paid.round(2) %></li>
      <% end %>
    </ul>
  </div>

  <hr>

  <!-- Settlements -->
  <div class="mb-4">
    <h3>Who Owes What</h3>
    <% @settlements.each do |transaction| %>
      <p><%= transaction %></p>
    <% end %>
  </div>
</div>

<!-- Optional: Your toggle chart script can go here or on the expense breakdown page -->
